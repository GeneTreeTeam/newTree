/**
 * Mark as style data
 * @function asStyleData
 * @param {string} scopeSelector - Selector which wraps data
 * @param {Object} data - Style data
 * @returns {Object} Style data
 */
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _argx = _interopRequireDefault(require("argx"));

var combineSelectors = function combineSelectors() {
  for (var _len = arguments.length, selectors = new Array(_len), _key = 0; _key < _len; _key++) {
    selectors[_key] = arguments[_key];
  }

  return selectors.filter(Boolean).map(function (selector) {
    return String(selector).trim();
  }).reduce(function (combined, selector) {
    if (!combined) {
      return selector;
    }

    var JOIN_PATTERN = /^&/;

    if (JOIN_PATTERN.test(selector)) {
      return combined + selector.replace(JOIN_PATTERN, '');
    }

    return [combined, selector].join(' ');
  }, null).trim();
};

var selectorData = function selectorData(selector, data) {
  var attributes = {};
  var nested = {};

  var _arr = Object.keys(data);

  for (var _i = 0; _i < _arr.length; _i++) {
    var key = _arr[_i];

    switch ((0, _typeof2.default)(data[key])) {
      case 'object':
        {
          nested[key] = data[key];
          break;
        }

      default:
        {
          attributes[key] = data[key];
          break;
        }
    }
  }

  return Object.assign((0, _defineProperty2.default)({}, selector, attributes), asStyleData(selector, nested));
};
/** @lends asStyleData */


function asStyleData(scopeSelector, data) {
  var args = (0, _argx.default)(arguments);
  scopeSelector = args.shift('string');
  data = args.pop('object');
  return Object.keys(data).reduce(function (scoped, selector) {
    return Object.assign.apply(Object, [scoped].concat((0, _toConsumableArray2.default)(selector.split(',').map(function (aSelector) {
      var created = selectorData(combineSelectors(scopeSelector, aSelector), data[selector]);
      return Object.keys(created).reduce(function (result, key) {
        return Object.assign(result, (0, _defineProperty2.default)({}, key, Object.assign({}, scoped[key] || {}, created[key])));
      }, {});
    }))));
  }, {});
}

var _default = asStyleData;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzU3R5bGVEYXRhLmpzeCJdLCJuYW1lcyI6WyJjb21iaW5lU2VsZWN0b3JzIiwic2VsZWN0b3JzIiwiZmlsdGVyIiwiQm9vbGVhbiIsIm1hcCIsInNlbGVjdG9yIiwiU3RyaW5nIiwidHJpbSIsInJlZHVjZSIsImNvbWJpbmVkIiwiSk9JTl9QQVRURVJOIiwidGVzdCIsInJlcGxhY2UiLCJqb2luIiwic2VsZWN0b3JEYXRhIiwiZGF0YSIsImF0dHJpYnV0ZXMiLCJuZXN0ZWQiLCJPYmplY3QiLCJrZXlzIiwia2V5IiwiYXNzaWduIiwiYXNTdHlsZURhdGEiLCJzY29wZVNlbGVjdG9yIiwiYXJncyIsImFyZ3VtZW50cyIsInNoaWZ0IiwicG9wIiwic2NvcGVkIiwic3BsaXQiLCJhU2VsZWN0b3IiLCJjcmVhdGVkIiwicmVzdWx0Il0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQU9BOzs7Ozs7Ozs7Ozs7Ozs7QUFDQTs7QUFFQSxJQUFNQSxnQkFBZ0IsR0FBRyxTQUFuQkEsZ0JBQW1CO0FBQUEsb0NBQUlDLFNBQUo7QUFBSUEsSUFBQUEsU0FBSjtBQUFBOztBQUFBLFNBQWtCQSxTQUFTLENBQ2pEQyxNQUR3QyxDQUNqQ0MsT0FEaUMsRUFFeENDLEdBRndDLENBRXBDLFVBQUNDLFFBQUQ7QUFBQSxXQUFjQyxNQUFNLENBQUNELFFBQUQsQ0FBTixDQUFpQkUsSUFBakIsRUFBZDtBQUFBLEdBRm9DLEVBR3hDQyxNQUh3QyxDQUdqQyxVQUFDQyxRQUFELEVBQVdKLFFBQVgsRUFBd0I7QUFDOUIsUUFBSSxDQUFDSSxRQUFMLEVBQWU7QUFDYixhQUFPSixRQUFQO0FBQ0Q7O0FBQ0QsUUFBTUssWUFBWSxHQUFHLElBQXJCOztBQUNBLFFBQUlBLFlBQVksQ0FBQ0MsSUFBYixDQUFrQk4sUUFBbEIsQ0FBSixFQUFpQztBQUMvQixhQUFPSSxRQUFRLEdBQUdKLFFBQVEsQ0FBQ08sT0FBVCxDQUFpQkYsWUFBakIsRUFBK0IsRUFBL0IsQ0FBbEI7QUFDRDs7QUFDRCxXQUFPLENBQUNELFFBQUQsRUFBV0osUUFBWCxFQUFxQlEsSUFBckIsQ0FBMEIsR0FBMUIsQ0FBUDtBQUNELEdBWndDLEVBWXRDLElBWnNDLEVBYXhDTixJQWJ3QyxFQUFsQjtBQUFBLENBQXpCOztBQWVBLElBQU1PLFlBQVksR0FBRyxTQUFmQSxZQUFlLENBQUNULFFBQUQsRUFBV1UsSUFBWCxFQUFvQjtBQUN2QyxNQUFNQyxVQUFVLEdBQUcsRUFBbkI7QUFDQSxNQUFNQyxNQUFNLEdBQUcsRUFBZjs7QUFGdUMsYUFHckJDLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZSixJQUFaLENBSHFCOztBQUd2QywyQ0FBcUM7QUFBaEMsUUFBTUssR0FBRyxXQUFUOztBQUNILGtDQUFlTCxJQUFJLENBQUNLLEdBQUQsQ0FBbkI7QUFDRSxXQUFLLFFBQUw7QUFBZTtBQUNiSCxVQUFBQSxNQUFNLENBQUNHLEdBQUQsQ0FBTixHQUFjTCxJQUFJLENBQUNLLEdBQUQsQ0FBbEI7QUFDQTtBQUNEOztBQUNEO0FBQVM7QUFDUEosVUFBQUEsVUFBVSxDQUFDSSxHQUFELENBQVYsR0FBa0JMLElBQUksQ0FBQ0ssR0FBRCxDQUF0QjtBQUNBO0FBQ0Q7QUFSSDtBQVVEOztBQUNELFNBQU9GLE1BQU0sQ0FBQ0csTUFBUCxtQ0FDSmhCLFFBREksRUFDT1csVUFEUCxHQUVKTSxXQUFXLENBQUNqQixRQUFELEVBQVdZLE1BQVgsQ0FGUCxDQUFQO0FBR0QsQ0FsQkQ7QUFvQkE7OztBQUNBLFNBQVNLLFdBQVQsQ0FBc0JDLGFBQXRCLEVBQXFDUixJQUFyQyxFQUEyQztBQUN6QyxNQUFNUyxJQUFJLEdBQUcsbUJBQUtDLFNBQUwsQ0FBYjtBQUNBRixFQUFBQSxhQUFhLEdBQUdDLElBQUksQ0FBQ0UsS0FBTCxDQUFXLFFBQVgsQ0FBaEI7QUFDQVgsRUFBQUEsSUFBSSxHQUFHUyxJQUFJLENBQUNHLEdBQUwsQ0FBUyxRQUFULENBQVA7QUFDQSxTQUFPVCxNQUFNLENBQUNDLElBQVAsQ0FBWUosSUFBWixFQUNKUCxNQURJLENBQ0csVUFBQ29CLE1BQUQsRUFBU3ZCLFFBQVQsRUFBc0I7QUFDNUIsV0FBT2EsTUFBTSxDQUFDRyxNQUFQLE9BQUFILE1BQU0sR0FBUVUsTUFBUiwwQ0FDUnZCLFFBQVEsQ0FBQ3dCLEtBQVQsQ0FBZSxHQUFmLEVBQW9CekIsR0FBcEIsQ0FBd0IsVUFBQzBCLFNBQUQsRUFBZTtBQUN4QyxVQUFNQyxPQUFPLEdBQUdqQixZQUFZLENBQzFCZCxnQkFBZ0IsQ0FBQ3VCLGFBQUQsRUFBZ0JPLFNBQWhCLENBRFUsRUFFMUJmLElBQUksQ0FBQ1YsUUFBRCxDQUZzQixDQUE1QjtBQUlBLGFBQU9hLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZWSxPQUFaLEVBQXFCdkIsTUFBckIsQ0FBNEIsVUFBQ3dCLE1BQUQsRUFBU1osR0FBVDtBQUFBLGVBQWlCRixNQUFNLENBQUNHLE1BQVAsQ0FBY1csTUFBZCxvQ0FDakRaLEdBRGlELEVBQzNDRixNQUFNLENBQUNHLE1BQVAsQ0FBYyxFQUFkLEVBQWtCTyxNQUFNLENBQUNSLEdBQUQsQ0FBTixJQUFlLEVBQWpDLEVBQXFDVyxPQUFPLENBQUNYLEdBQUQsQ0FBNUMsQ0FEMkMsRUFBakI7QUFBQSxPQUE1QixFQUVILEVBRkcsQ0FBUDtBQUdELEtBUkUsQ0FEUSxHQUFiO0FBV0QsR0FiSSxFQWFGLEVBYkUsQ0FBUDtBQWNEOztlQUVjRSxXIiwic291cmNlUm9vdCI6Ii4uL2xpYiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTWFyayBhcyBzdHlsZSBkYXRhXG4gKiBAZnVuY3Rpb24gYXNTdHlsZURhdGFcbiAqIEBwYXJhbSB7c3RyaW5nfSBzY29wZVNlbGVjdG9yIC0gU2VsZWN0b3Igd2hpY2ggd3JhcHMgZGF0YVxuICogQHBhcmFtIHtPYmplY3R9IGRhdGEgLSBTdHlsZSBkYXRhXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBTdHlsZSBkYXRhXG4gKi9cbid1c2Ugc3RyaWN0J1xuaW1wb3J0IGFyZ3ggZnJvbSAnYXJneCdcblxuY29uc3QgY29tYmluZVNlbGVjdG9ycyA9ICguLi5zZWxlY3RvcnMpID0+IHNlbGVjdG9yc1xuICAuZmlsdGVyKEJvb2xlYW4pXG4gIC5tYXAoKHNlbGVjdG9yKSA9PiBTdHJpbmcoc2VsZWN0b3IpLnRyaW0oKSlcbiAgLnJlZHVjZSgoY29tYmluZWQsIHNlbGVjdG9yKSA9PiB7XG4gICAgaWYgKCFjb21iaW5lZCkge1xuICAgICAgcmV0dXJuIHNlbGVjdG9yXG4gICAgfVxuICAgIGNvbnN0IEpPSU5fUEFUVEVSTiA9IC9eJi9cbiAgICBpZiAoSk9JTl9QQVRURVJOLnRlc3Qoc2VsZWN0b3IpKSB7XG4gICAgICByZXR1cm4gY29tYmluZWQgKyBzZWxlY3Rvci5yZXBsYWNlKEpPSU5fUEFUVEVSTiwgJycpXG4gICAgfVxuICAgIHJldHVybiBbY29tYmluZWQsIHNlbGVjdG9yXS5qb2luKCcgJylcbiAgfSwgbnVsbClcbiAgLnRyaW0oKVxuXG5jb25zdCBzZWxlY3RvckRhdGEgPSAoc2VsZWN0b3IsIGRhdGEpID0+IHtcbiAgY29uc3QgYXR0cmlidXRlcyA9IHt9XG4gIGNvbnN0IG5lc3RlZCA9IHt9XG4gIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKGRhdGEpKSB7XG4gICAgc3dpdGNoICh0eXBlb2YgZGF0YVtrZXldKSB7XG4gICAgICBjYXNlICdvYmplY3QnOiB7XG4gICAgICAgIG5lc3RlZFtrZXldID0gZGF0YVtrZXldXG4gICAgICAgIGJyZWFrXG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIGF0dHJpYnV0ZXNba2V5XSA9IGRhdGFba2V5XVxuICAgICAgICBicmVha1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gT2JqZWN0LmFzc2lnbih7XG4gICAgW3NlbGVjdG9yXTogYXR0cmlidXRlcyxcbiAgfSwgYXNTdHlsZURhdGEoc2VsZWN0b3IsIG5lc3RlZCkpXG59XG5cbi8qKiBAbGVuZHMgYXNTdHlsZURhdGEgKi9cbmZ1bmN0aW9uIGFzU3R5bGVEYXRhIChzY29wZVNlbGVjdG9yLCBkYXRhKSB7XG4gIGNvbnN0IGFyZ3MgPSBhcmd4KGFyZ3VtZW50cylcbiAgc2NvcGVTZWxlY3RvciA9IGFyZ3Muc2hpZnQoJ3N0cmluZycpXG4gIGRhdGEgPSBhcmdzLnBvcCgnb2JqZWN0JylcbiAgcmV0dXJuIE9iamVjdC5rZXlzKGRhdGEpXG4gICAgLnJlZHVjZSgoc2NvcGVkLCBzZWxlY3RvcikgPT4ge1xuICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oc2NvcGVkLFxuICAgICAgICAuLi5zZWxlY3Rvci5zcGxpdCgnLCcpLm1hcCgoYVNlbGVjdG9yKSA9PiB7XG4gICAgICAgICAgY29uc3QgY3JlYXRlZCA9IHNlbGVjdG9yRGF0YShcbiAgICAgICAgICAgIGNvbWJpbmVTZWxlY3RvcnMoc2NvcGVTZWxlY3RvciwgYVNlbGVjdG9yKSxcbiAgICAgICAgICAgIGRhdGFbc2VsZWN0b3JdXG4gICAgICAgICAgKVxuICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhjcmVhdGVkKS5yZWR1Y2UoKHJlc3VsdCwga2V5KSA9PiBPYmplY3QuYXNzaWduKHJlc3VsdCwge1xuICAgICAgICAgICAgW2tleV06IE9iamVjdC5hc3NpZ24oe30sIHNjb3BlZFtrZXldIHx8IHt9LCBjcmVhdGVkW2tleV0pLFxuICAgICAgICAgIH0pLCB7fSlcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICB9LCB7fSlcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXNTdHlsZURhdGFcbiJdfQ==